[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

[program:sshd]
command=/usr/sbin/sshd -D
autostart=true
autorestart=true
priority=10
stdout_logfile=/var/log/supervisor/sshd.stdout.log
stderr_logfile=/var/log/supervisor/sshd.stderr.log

[program:dockerd]
command=/usr/bin/dockerd
autostart=true
autorestart=true
priority=20
stdout_logfile=/var/log/supervisor/dockerd.stdout.log
stderr_logfile=/var/log/supervisor/dockerd.stderr.log
environment=DOCKER_HOST="tcp://0.0.0.0:2375"

[program:code-server]
command=/usr/bin/code-server --bind-addr 0.0.0.0:8081 --auth password --user-data-dir /home/developer/.config/code-server /workspace
user=developer
autostart=true
autorestart=true
priority=30
stdout_logfile=/var/log/supervisor/code-server.stdout.log
stderr_logfile=/var/log/supervisor/code-server.stderr.log
environment=HOME="/home/developer",USER="developer",PASSWORD="%(ENV_CODE_SERVER_PASSWORD)s"

[program:claude-code-ui]
command=/bin/bash -c "cd /opt/claude-code-ui && npm install && npm start"
user=developer
autostart=true
autorestart=true
priority=40
stdout_logfile=/var/log/supervisor/claude-code-ui.stdout.log
stderr_logfile=/var/log/supervisor/claude-code-ui.stderr.log
environment=HOME="/home/developer",USER="developer",PORT="8080",NODE_ENV="production"

[program:vs-code-server]
command=/usr/bin/code-server --bind-addr 0.0.0.0:8082 --auth none --user-data-dir /opt/vs-code-server /workspace
user=developer
autostart=true
autorestart=true
priority=50
stdout_logfile=/var/log/supervisor/vs-code-server.stdout.log
stderr_logfile=/var/log/supervisor/vs-code-server.stderr.log
environment=HOME="/home/developer",USER="developer"

[program:tailscaled]
command=/usr/sbin/tailscaled --state=/var/lib/tailscale/tailscaled.state --socket=/var/run/tailscale/tailscaled.sock
autostart=true
autorestart=true
priority=5
stdout_logfile=/var/log/supervisor/tailscaled.stdout.log
stderr_logfile=/var/log/supervisor/tailscaled.stderr.log

[program:webmin]
command=/usr/share/webmin/miniserv.pl /etc/webmin/miniserv.conf
autostart=true
autorestart=true
priority=60
stdout_logfile=/var/log/supervisor/webmin.stdout.log
stderr_logfile=/var/log/supervisor/webmin.stderr.log

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock